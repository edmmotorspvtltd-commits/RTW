<!-- Navigation Component - Sale Order System (Based on RTWE Enquiry pattern) -->
<style>
    .navbar {
        background: linear-gradient(135deg, #6B4423 0%, #4A2F1A 100%);
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        position: sticky;
        top: 0;
        z-index: 1000;
    }

    .navbar ul {
        list-style: none;
        display: flex;
        margin: 0;
        padding: 0;
        max-width: 1400px;
        margin: 0 auto;
    }

    .navbar li {
        margin: 0;
    }

    .navbar a {
        display: flex;
        align-items: center;
        gap: 6px;
        padding: 14px 20px;
        color: rgba(255, 255, 255, 0.85);
        text-decoration: none;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s;
        border-bottom: 3px solid transparent;
    }

    .navbar a:hover {
        background: rgba(255, 255, 255, 0.1);
        color: white;
        border-bottom-color: #FFB74D;
    }

    .navbar a.active {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border-bottom-color: #FFB74D;
    }

    .navbar a .icon {
        font-size: 16px;
    }

    /* User info and logout */
    .navbar-right {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 15px;
        padding-right: 15px;
    }

    .nav-user-info {
        color: rgba(255, 255, 255, 0.9);
        font-size: 13px;
    }

    .nav-btn-logout {
        background: rgba(255, 255, 255, 0.15);
        color: white;
        border: none;
        padding: 8px 14px;
        border-radius: 6px;
        font-size: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
    }

    .nav-btn-logout:hover {
        background: rgba(255, 255, 255, 0.25);
    }

    /* Navigation Loading Overlay */
    .nav-loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(255, 255, 255, 0.95);
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        opacity: 0;
        visibility: hidden;
        transition: all 0.3s ease;
    }

    .nav-loading-overlay.show {
        opacity: 1;
        visibility: visible;
    }

    .nav-loading-spinner {
        width: 50px;
        height: 50px;
        border: 4px solid #E0E0E0;
        border-top: 4px solid #6B4423;
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    .nav-loading-text {
        margin-top: 15px;
        font-size: 16px;
        font-weight: 600;
        color: #6B4423;
    }

    @keyframes spin {
        0% {
            transform: rotate(0deg);
        }

        100% {
            transform: rotate(360deg);
        }
    }

    @media (max-width: 1024px) {
        .navbar ul {
            flex-wrap: wrap;
        }

        .navbar a {
            padding: 12px 16px;
            font-size: 12px;
        }
    }

    @media (max-width: 768px) {
        .navbar ul {
            flex-direction: column;
        }

        .navbar a {
            padding: 14px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-right {
            width: 100%;
            justify-content: center;
            padding: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
    }
</style>

<nav class="navbar">
    <ul>
        <li><a href="#" id="nav-dashboard" onclick="navigateTo('dashboard', 'Dashboard'); return false;">
                <span class="icon">üè†</span> Dashboard
            </a></li>

        <li><a href="#" id="nav-sale-order-form"
                onclick="navigateTo('sale-order-form', 'New Sale Order'); return false;">
                <span class="icon">üìù</span> New Sale Order
            </a></li>

        <li><a href="#" id="nav-pending-orders" onclick="navigateTo('pending-orders', 'Pending Orders'); return false;">
                <span class="icon">‚è≥</span> Pending Orders
            </a></li>

        <li><a href="#" id="nav-complete-orders"
                onclick="navigateTo('complete-orders', 'Complete Orders'); return false;">
                <span class="icon">‚úÖ</span> Complete Orders
            </a></li>

        <li><a href="#" id="nav-cancelled-orders"
                onclick="navigateTo('cancelled-orders', 'Cancelled Orders'); return false;">
                <span class="icon">‚ùå</span> Cancelled Orders
            </a></li>

        <div class="navbar-right">
            <span class="nav-user-info" id="navUserName">User</span>
            <button class="nav-btn-logout" onclick="handleNavLogout()">Logout</button>
        </div>
    </ul>
</nav>

<!-- Navigation Loading Overlay -->
<div id="navLoadingOverlay" class="nav-loading-overlay">
    <div class="nav-loading-spinner"></div>
    <div id="navLoadingText" class="nav-loading-text">Loading...</div>
</div>

<script>
    // Navigation function that builds URLs using parent page's webAppUrl and sessionId variables
    function navigateTo(page, pageName) {
        // Show loading overlay
        showNavLoading(pageName);

        // Get webAppUrl and sessionId from parent page's global variables
        let url;
        if (typeof webAppUrl !== 'undefined' && typeof sessionId !== 'undefined') {
            url = webAppUrl + '?page=' + page + '&sessionId=' + sessionId;
        } else {
            // Fallback: try to get from localStorage
            const storedUrl = localStorage.getItem('saleorder_webAppUrl');
            const storedSession = localStorage.getItem('saleorder_session');
            if (storedUrl && storedSession) {
                url = storedUrl + '?page=' + page + '&sessionId=' + storedSession;
            } else {
                alert('Session expired. Please login again.');
                return;
            }
        }

        // Navigate to the page
        window.location.href = url;
    }

    // Handle logout
    function handleNavLogout() {
        let url;
        if (typeof webAppUrl !== 'undefined') {
            url = webAppUrl + '?page=logout';
        } else {
            url = '?page=logout';
        }
        window.location.href = url;
    }

    // Show loading animation when navigating
    function showNavLoading(pageName) {
        const overlay = document.getElementById('navLoadingOverlay');
        const text = document.getElementById('navLoadingText');
        if (overlay && text) {
            text.textContent = 'Navigating to ' + pageName + '...';
            overlay.classList.add('show');
        }
    }

    // Auto-highlight active page and set user name
    (function () {
        const urlParams = new URLSearchParams(window.location.search);
        const page = urlParams.get('page') || 'dashboard';

        // Map page names to nav IDs
        const pageMap = {
            'dashboard': 'nav-dashboard',
            'sale-order-form': 'nav-sale-order-form',
            'pending-orders': 'nav-pending-orders',
            'complete-orders': 'nav-complete-orders',
            'cancelled-orders': 'nav-cancelled-orders'
        };

        const navId = pageMap[page];
        if (navId) {
            const activeLink = document.getElementById(navId);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        // Set user name if available
        if (typeof userName !== 'undefined' && userName) {
            const navUser = document.getElementById('navUserName');
            if (navUser) navUser.textContent = userName;
        }
    })();
</script>